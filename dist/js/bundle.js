!function(){"use strict";function t(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i}function e(t){return t||window.event}var i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=document.getElementById("canvas"),r=a.getContext("2d"),s=document.getElementsByTagName("p")[0],o=document.getElementById("choose"),h=o.getElementsByTagName("input")[0],c=o.getElementsByTagName("input")[1],l=function(){function o(t){i(this,o),this.n=t.n||3,this.initDom(this.n)}return n(o,[{key:"initDom",value:function(t){var e=Math.min(800,document.documentElement.clientWidth),i=document.documentElement.clientHeight;a.setAttribute("width",e+"px"),a.setAttribute("height",.6*i+"px"),a.style.className="canvas",this.initCanvas(t),this.addEvent()}},{key:"initParams",value:function(t){this.r=0,this.arr=[],this.restPoint=[],this.lastPoint=[],this.touchFlag=!1}},{key:"initCanvas",value:function(t){this.initParams(),this.r=r.canvas.width/(2+4*t);for(n=0;n<t;n++)for(var e=0;e<t;e++){var i={x:4*e*this.r+3*this.r,y:4*n*this.r+3*this.r};this.arr.push(i),this.restPoint.push(i)}r.clearRect(0,0,r.canvas.width,r.canvas.height);for(var n=0;n<this.arr.length;n++)this.drawCircle(this.arr[n].x,this.arr[n].y)}},{key:"drawCircle",value:function(t,e){r.strokeStyle="#FFA500",r.lineWidth=2,r.beginPath(),r.arc(t,e,this.r,0,2*Math.PI,!0),r.closePath(),r.stroke()}},{key:"drawCurCir",value:function(t,e){r.fillStyle="#FFA500",r.lineWidth=2,r.beginPath(),r.arc(t,e,this.r,0,2*Math.PI,!0),r.closePath(),r.fill()}},{key:"drawPoint",value:function(t,e){r.fillStyle="#FF0000",r.beginPath(),r.arc(t,e,2,0,2*Math.PI,!0),r.closePath(),r.fill()}},{key:"drawLine",value:function(t,e){if(this.lastPoint){r.beginPath(),r.lineWidth=3,r.moveTo(this.lastPoint[0].x,this.lastPoint[0].y);for(var i=0;i<this.lastPoint.length;i++)r.lineTo(this.lastPoint[i].x,this.lastPoint[i].y);r.lineTo(t.x,t.y),r.stroke(),r.closePath()}}},{key:"getPosition",value:function(t){var e=t.currentTarget.getBoundingClientRect();return{x:Math.floor(t.touches[0].clientX-e.left),y:Math.floor(t.touches[0].clientY-e.top)}}},{key:"updatePosition",value:function(t){r.clearRect(0,0,r.canvas.width,r.canvas.height);for(e=0;e<this.arr.length;e++)this.drawCircle(this.arr[e].x,this.arr[e].y);this.drawPoint(this.lastPoint),this.drawLine(t,this.lastPoint);for(var e=0;e<this.restPoint.length;e++)if(Math.abs(t.x-this.restPoint[e].x)<this.r&&Math.abs(t.y-this.restPoint[e].y)<this.r){this.drawPoint(this.restPoint[e].x,this.restPoint[e].y),this.drawCurCir(this.restPoint[e].x,this.restPoint[e].y),this.lastPoint.push(this.restPoint[e]),this.restPoint.splice(e,1);break}}},{key:"addEvent",value:function(){var i=this;t(a,"touchstart",function(t){t=e(t);for(var n=i.getPosition(t),a=0;a<i.arr.length;a++)if(Math.abs(n.x-i.arr[a].x)<i.r&&Math.abs(n.y-i.arr[a].y)<i.r){i.touchFlag=!0,i.drawPoint(i.arr[a].x,i.arr[a].y),i.drawCurCir(i.arr[a].x,i.arr[a].y),i.lastPoint.push(i.arr[a]),i.restPoint.splice(a,1);break}}),t(a,"touchmove",function(t){i.touchFlag&&(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}(t=e(t)),i.updatePosition(i.getPosition(t)))}),t(a,"touchend",function(t){i.touchFlag&&(i.touchFlag=!1,i.initPwd())})}},{key:"initPwd",value:function(){1==h.checked&&this.setupPwd(this.lastPoint),1==c.checked&&this.verifyPwd(this.lastPoint)}},{key:"setupPwd",value:function(t){var e=this;t.length<=4?(s.innerHTML="密码太短，至少需要5个点",setTimeout(function(){e.initCanvas(e.n)},1e3)):this.checkStorage(t)}},{key:"verifyPwd",value:function(t){var e=this;this.checkPwd(t)?s.innerHTML="密码正确!":(s.innerHTML="输入的密码不正确",setTimeout(function(){e.initCanvas(e.n)},1e3))}},{key:"checkStorage",value:function(t){var e=this;if(window.localStorage.getItem("password"))t||(s.innerHTML="请输入手势密码"),this.checkPwd(t)?(s.innerHTML="密码设置成功",setTimeout(function(){e.initCanvas(e.n),c.setAttribute("checked",!0)},1e3)):(s.innerHTML="两次输入的不一致",window.localStorage.setItem("password",""),setTimeout(function(){e.initCanvas(e.n),s.innerHTML="请重新输入手势密码"},1e3));else{var i=JSON.stringify(t);window.localStorage.setItem("password",i),setTimeout(function(){e.initCanvas(e.n),s.innerHTML="请再次输入手势密码"},1e3)}}},{key:"checkPwd",value:function(t){var e=JSON.parse(window.localStorage.getItem("password"));if(e.length!=t.length)return!1;for(var i=0;i<e.length;i++)if(e[i].x!=t[i].x||e[i].y!=t[i].y)return!1;return!0}}]),o}(),u={n:3};window.onload=function(){new l(u)}}();
//# sourceMappingURL=bundle.js.map
